/*
 * Magic jQuery JavaScript Library v1.1.10
 * http://jquery-css.com/
 *
 * Copyright 2011, Bastien LIUTKUS from Binary Mind
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 * Need resize plugin
 * Need hoverIntent plugin
 *
 * Date: Fri April 1 22:13 2011 (Fishy fishy oooh)
 */
jQuery.magic={locked:{align:false,unAlign:false,limit:false,createGhost:false,refreshAlignWatchers:false},alignTargets:[],alignWatchers:[],limit:[],resizable:[],menu:[],ghosts:[],ghostContainer:null,timers:[],browser:{ie6:(($.browser.msie&&$.browser.version=="6.0"))?true:false,iStuff:(navigator.platform=='iPad'||navigator.platform=='iPhone'||navigator.platform=='iPod')?true:false,iPad:navigator.platform=='iPad',fixedSupport:!(($.browser.msie&&$.browser.version=="6.0")||(navigator.platform=='iPad'||navigator.platform=='iPhone'||navigator.platform=='iPod'))},defaultAction:(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))?"click":"over",staticClass:"fixed",bodyWrapper:$(window),bodyContainer:$(window),tools:{areHashEqual:function(a,b){for(var i in a){if(b[i]==undefined||(typeof b[i]!="object"&&a[i]!=b[i])||(typeof b[i]=="object"&&typeof a[i]=="object"&&!$.magic.tools.areHashEqual(b[i],a[i]))){return false}}return true},removeDuplicates:function(a){var r=[];o:for(var i=0,n=a.length;i<n;i++){for(var x=0,y=r.length;x<y;x++){if(r[x]==a[i]){continue o}if(typeof r[x]=="object"&&typeof a[i]=="object"&&$.magic.tools.areHashEqual(r[x],a[i])){continue o}}r[r.length]=a[i]}return r},removeItems:function(a,b){if(!a||!b){return a}var j;for(var i=0;i<b.length;i++){j=0;while(j<a.length){if(a[j]==b[i]||(typeof a[j]=="object"&&typeof b[i]=="object"&&$.magic.tools.areHashEqual(a[j],b[i]))){a.splice(j,1)}else{j++}}}return a}},coord:{dir:{top:-1,topIsBottomOf:-3,right:2,rightIsLeftOf:4,bottom:1,bottomIsTopOf:3,left:-2,leftIsRightOf:-4,center:0},cache:[],clearCache:function(x){$.magic.coord.cache=[]},isDirection:function(x){return(this.dir[x]!=undefined)},isVertical:function(x){return(this.dir[x]==0||(this.dir[x]%2!=0))},isHorizontal:function(x){return(this.dir[x]%2==0)},isMaxValue:function(x){if(this.dir[x]>0){return true}else{return false}},target:function(x){if(Math.abs(this.dir[x])>2){return $.magic.coord.side($.magic.coord.opposite(x))}return x},distanceToOpposite:function(a,x){var b=a.coordinates();if(this.isVertical(x)){if(this.dir[x]<0){return b.height}else{if(this.dir[x]==0){return 0}else{return-b.height}}}else{if(this.dir[x]<0){return b.width}else{return-b.width}}},distanceNameForThisDirection:function(x){if(this.isVertical(x)){return"height"}else{return"width"}},opposite:function(x){for(var y in this.dir){if(this.dir[x]==-this.dir[y]){return y}}return null},side:function(x){if(this.isVertical(x)){if(this.dir[x]<0){return"top"}else{if(this.dir[x]==0){return"center"}else{return"bottom"}}}else{if(this.dir[x]<0){return"left"}else{return"right"}}}},popOutCallBack:function(c){var d=false;c.each(function(){var a=$(this);if(a.hasClass("hadGhost")){a.removeClass('poppedIn hadGhost');var b=$("#"+$.magic.ghosts[a.getNotNullId()]);b.detach();b.prependTo($.magic.ghostContainer)}else{a.removeClass('poppedIn');a.setPosition(null);d=true}});if(d){$(window).resize()}},getElementFromNotNullId:function(a){if(a==''){return $(window)}else{return $("#"+(($.magic.ghosts[a]!=undefined&&$.magic.ghosts[a]!=null)?$.magic.ghosts[a]:a))}},applyPosition:function(a,b,c){delete $.magic.coord.cache[b];a.css(c)},init:function(){$.magic.bodyWrapper.bind('scroll',$.magic.coord.clearCache);$.magic.bodyWrapper.bind('resize',$.magic.coord.clearCache);$("body").append('<div class="absolute" style="z-index:10000000;width:100%;height:0;"><div id="ghostContainer" class="relative" style="width:100%; margin:0; padding:0;text-align:left;"></div></div>');$.magic.ghostContainer=$("#ghostContainer");if(!($.magic.browser.fixedSupport)){var b=function(){$.magic.coord.clearCache();for(x in $.magic.alignTargets){var a=$("#"+x);if(a==null){continue}if($.magic.alignTargets[x]){$.magic.alignTargets[x].alignFunction();a.refreshAlignWatchers()}}for(x in $.magic.limit){var a=$("#"+x);if(a==null){continue}a._limit()}return false};if($.magic.browser.iStuff){window.onscroll=b}else{$.magic.bodyWrapper.bind('scroll',b)}$.magic.bodyWrapper.bind('resize',b);$('.fixed').each(function(){$(this).target.setPosition('fixed')})}}};(function($){$.fn.getNotNullId=function(){var a=$(this);if(!$.isWindow(a[0])){var b=a.attr('id');if(!b){b="me-"+Math.floor(Math.random()*10000);a.attr('id',b)}return b}else{return""}};$.fn._getOriginalId=function(){var a=$(this);var b=a.getNotNullId();if(a.hasClass('ghost')){b=b.substring(6,b.length)}return b};$.fn.refreshAlignWatchers=function(c){var d=$(this);$.magic.locked.refreshAlignWatchers=true;if(c==undefined){c=d.getNotNullId()}var e={};if($.magic.alignWatchers[c]!=undefined){$.each($.magic.alignWatchers[c],function(a,b){if(!e[b]){$("#"+b).align($.magic.alignTargets[b].options);e[b]=true}})}var f=d.find('.alignTarget');$.each(f,function(){childTargetId=$(this).getNotNullId();if(!e[childTargetId]){e[childTargetId]=true;if($.magic.alignWatchers[childTargetId]!=undefined){$.each($.magic.alignWatchers[childTargetId],function(a,b){if(!e[b]){e[b]=true;if($.magic.alignTargets[b]){$("#"+b).align($.magic.alignTargets[b].options)}}})}}});delete e;$.magic.locked.refreshAlignWatchers=false};$.fn.coordinates=function(a){var b=null;var c=false;if(a==undefined||a==null){c=true}else if(typeof a=="string"){b=a;a=[];a[b]=true}var d=[];var e=$(this);var f=e.getNotNullId();if(!($.magic.coord.cache[f])){if($.isWindow(e[0])){$.magic.coord.cache[f]={left:$(window).scrollLeft(),top:$(window).scrollTop(),width:e.width(),height:e.height()};$.magic.coord.cache[f].delta={width:0,height:0}}else{var g=e.offset();$.magic.coord.cache[f]={top:g.top,left:g.left,width:e.outerWidth(),height:e.outerHeight()};$.magic.coord.cache[f].delta={width:$.magic.coord.cache[f].width-e.width(),height:$.magic.coord.cache[f].height-e.height()}}$.magic.coord.cache[f].right=$.magic.coord.cache[f].left+$.magic.coord.cache[f].width;$.magic.coord.cache[f].bottom=$.magic.coord.cache[f].top+$.magic.coord.cache[f].height}if(c){return $.magic.coord.cache[f]}for(var x in a){if(a[x]==true)d[x]=$.magic.coord.cache[f][x]}if(b){return d[b]}return d};$.fn.coordinatesOf=function(a){var b=$(this);var c=null;if(typeof a=="string"){c=a}var d=b.coordinates();var e=[];for(var x in a){if(!$.magic.coord.isDirection(x)||a[x]=="auto"){e[x]=a[x];continue}var f=(d[x]!=undefined?d[x]:0);if($.magic.coord.isMaxValue(x)){e[x]=f-a[x]}else{e[x]=a[x]-f}}if(c){return e[c]}return e};if(typeof $.fn.resizable=='undefined'||(typeof overrideResizable!='undefined'&&overrideResizable==true)){$.fn.resizable=function(q){var r={side:{top:true,right:true,bottom:true,left:true},aspectRatio:false,distance:30,grid:false,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10};q=$.extend(r,q);return this.each(function(){var o=$(this);var p=o._getOriginalId();if($.magic.resizable[p]){q=$.extend($.magic.resizable[p].options,q);$.magic.resizable[p].options=q}else{$.magic.resizable[p]={options:q,sideActive:[],unActive:function(){$("body").css("cursor","auto");o.removeClass('tNoSelect');document.onselectstart='returnTrue';delete $.magic.resizable.active},detectFunction:function(a,b){if($.magic.resizable.active){return true}var c=a.coordinates({top:true,right:true,bottom:true,left:true});var d=0;var e=[];var f='';for(side in $.magic.resizable[p].options.side){if($.magic.resizable[p].options.side[side]){var g="pageX";if($.magic.coord.isVertical(side)){g="pageY"}if(Math.abs(c[side]-b[g])<=$.magic.resizable[p].options.distance){e[side]=true;d++;if($.magic.coord.isVertical(side)){f=side+f}else{f=f+side}}}}if(d>=($.magic.resizable[p].options.aspectRatio?2:1)){f=f.replace("top","n").replace("left","w").replace("bottom","s").replace("right","e")+'-resize';o.addClass('tNoSelect');$("body").css("cursor",f);$.magic.resizable[p].sideActive=e;b.stopPropagation();return true}else{$.magic.resizable[p].unActive()}return false},resizeFunction:function(a){a.stopPropagation();document.onselectstart='returnFalse';var b=$.magic.resizable.active;if(!b){return}if($.magic.ghosts[$.magic.resizable.active]!=null&&($.magic.ghosts[$.magic.resizable.active]!=undefined)){var c=$('#'+$.magic.ghosts[$.magic.resizable.active])}else{var c=$('#'+$.magic.resizable.active)}var d=c.coordinates();var e={left:parseInt(a.pageX),top:parseInt(a.pageY)};if($.magic.resizable[b].options.aspectRatio){var f=$.magic.resizable[b].sideActive.left?"left":"right";var g=$.magic.resizable[b].sideActive.top?"top":"bottom";e.width=Math.abs(e.left-d[$.magic.coord.opposite(f)]);e.height=Math.abs(e.top-d[$.magic.coord.opposite(g)]);var h=typeof $.magic.resizable[b].options.aspectRatio=="boolean"?d.width/Math.max(1,d.height):$.magic.resizable[b].options.aspectRatio;if(e.width/h>e.height){e.left=d[$.magic.coord.opposite(f)]+($.magic.coord.isMaxValue(f)?+e.height*h:-e.height*h)}else{e.top=d[$.magic.coord.opposite(g)]+($.magic.coord.isMaxValue(g)?+e.width/h:-e.width/h)}}if($.magic.resizable[b].options.grid){e={left:e.left-e.left%$.magic.resizable[b].options.grid[0],top:e.top-e.top%$.magic.resizable[b].options.grid[1]}}var i=[];for(side in $.magic.resizable[b].sideActive){var j=$.magic.coord.distanceNameForThisDirection(side);var k=j.charAt(0).toUpperCase()+j.slice(1);var l=$.magic.coord.isVertical(side);var m=e[l?'top':'left'];var n=m-d[side];if(!$.magic.coord.isMaxValue(side)){i[side]=m;i[j]=d[j]-n-d.delta[j]}else{i[j]=d[j]+n}i[j]=Math.max($.magic.resizable[b].options["min"+k],i[j]);if($.magic.resizable[b].options["max"+k]){i[j]=Math.min($.magic.resizable[b].options["max"+k],i[j])}}if(c.hasClass($.magic.staticClass)&&$.magic.browser.fixedSupport){i=$(window).coordinatesOf(i)}else{i=c.parent().coordinatesOf(i)}$.magic.applyPosition(c,b,i);$.magic.coord.clearCache();$(window).resize()}};o.mousemove(function(a){$.magic.resizable[p].detectFunction($(this),a)});o.mouseleave(function(a){if(!$.magic.resizable.active){$.magic.resizable[p].unActive()}});o.mousedown(function(a){$.magic.resizable.active=p;a.stopPropagation();$("body").mousemove($.magic.resizable[p].resizeFunction)});$("body").mouseup(function(a){if($.magic.resizable.active){$("body").unbind('mousemove',$.magic.resizable[$.magic.resizable.active].resizeFunction);$.magic.resizable[$.magic.resizable.active].unActive()}})}})}}$.fn.limit=function(f){if(typeof f=="string"){f={top:f,right:f,bottom:f,left:f}}else{var g={}}f=$.extend(g,f);return this.each(function(){var a=$(this);var b=a.getNotNullId();if(b==""){return}var c=[];for(var d in f){var e=$.magic.coord.side(d);c[e]={direction:d,id:f[d]}}$.magic.limit[b]={options:c,limiting:[],unAligned:[],unactivatedValues:[],startLimitValue:[],unactivatedLimits:{}};if($.magic.browser.fixedSupport){$.magic.bodyWrapper.bind("scroll",function(){$('#'+b)._limit()});$.magic.bodyWrapper.bind("resize",function(){$('#'+b)._limit()})}})};$.fn.setLimit=function(a){this.limit(a)};$.fn._limit=function(){if($.magic.locked.limit==false){this._executeLimit()}};$.fn._executeLimit=function(){if($.magic.locked.align==true||$.magic.locked.unAlign==true||$.magic.locked.createGhost==true){return}var a=$(this);var b=a.attr('id');var c=a;var d=b;var e=$.magic.limit[d];if(!e){return}if($.magic.ghosts[b]!=null&&($.magic.ghosts[b]!=undefined)){b=$.magic.ghosts[b];a=$('#'+b)}if(b!=""&&!a.is(":visible")){return}$.magic.locked.limit=true;var f=a.coordinates();var g={left:null,top:null,right:null,bottom:null,height:f.height,width:f.width};if($.magic.alignTargets[d]){for(var u in $.magic.alignTargets[d].options){if($.magic.alignTargets[d].options[u]==null||!$.magic.coord.isDirection(u)){continue}var h=$.magic.alignTargets[d].options[u];var j=$.magic.getElementFromNotNullId(h);if(h!=''&&!j.is(":visible")){continue}var l=$.magic.coord.side(u);var m=$.magic.coord.target(u);var n=$.magic.coord.opposite(l);var o=$.magic.alignTargets[d].options.offset[l]?$.magic.alignTargets[d].options.offset[l]:0;var p=$.magic.coord.isMaxValue(m)?-o:o;g[l]={value:j.coordinates(m)+p,direction:u,id:h,offset:o,add:e.limiting[l]!=h};if(!g[n]){g[n]={value:g[l].value+$.magic.coord.distanceToOpposite(a,l),direction:u,id:h,offset:o,add:g[l].add}}}g.manual=$.magic.alignTargets[d].options.manual}for(var x in g){if(g[x]==null){g[x]={value:f[x],direction:x,id:d,offset:0}}}var q={left:null,top:null,right:null,bottom:null};for(var l in e.unAligned){if(!e.unAligned[l]){continue}var n=$.magic.coord.opposite(l);if(e.unactivatedLimits[l]!=undefined||e.unactivatedLimits[n]!=undefined){continue}var r=$.magic.coord.isMaxValue(l);var s=$.magic.coord.distanceToOpposite(a,n);for(var t=0;t<e.unAligned[l].length;t++){var v=e.unAligned[l][t];var w=$.magic.getElementFromNotNullId(v.id);if(v.id!=''&&!w.is(":visible")){continue}var p=$.magic.coord.isMaxValue(v.direction)?-v.offset:v.offset;var y=$.magic.coord.target(v.direction);var z=$.magic.coord.distanceToOpposite(a,l);var A={direction:v.direction,id:v.id,value:w.coordinates(y)+p,offset:v.offset};if(n==$.magic.coord.side(v.direction)){A.value+=s}if(g.manual==false&&e.startLimitValue[l]){A.realValue=A.value;A.value=r?Math.min(A.value,g[l].value):Math.max(A.value,g[l].value)}var B={value:A.value+z,direction:A.direction,id:A.id,offset:v.offset};if(g.manual==false&&e.startLimitValue[n]){B.value=r?Math.max(B.value,g[l].value):Math.min(B.value,g[l].value);A.value=B.value-z}var C=q[l]&&(((A.value<q[l].value)==r)||(A.value==q[l].value))&&((($.magic.coord.side(A.direction)==l)&&A.value==q[l].value)||(A.value!=q[l].value));var D=q[n]&&(((B.value<q[n].value)==r)||(B.value==q[n].value))&&((($.magic.coord.side(A.direction)==n)&&A.value==q[l].value)||(B.value!=q[n].value));if(!q[l]||C){q[l]=A;q[l].unAligned=v}if(!q[n]||D){q[n]=B;q[n].unAligned=v}}}var E={};var F={};var G={};var H={};var I=false;var J=false;var K=false;var L=false;var M={};var N={};for(var x in e.options){if(e.options[x].id==null||e.options[x].id==undefined){continue}var O=e.options[x].id;var P=$.magic.getElementFromNotNullId(O);var Q=P.getNotNullId();if(Q!=""&&!P.is(":visible")){continue}var l=$.magic.coord.side(x);var n=$.magic.coord.opposite(l);var r=$.magic.coord.isMaxValue(l);var R={offset:0,value:P.coordinates($.magic.coord.target(e.options[x].direction)),direction:e.options[x].direction,id:O};var S=e.startLimitValue[l];var T=(e.limiting[l]!=undefined&&e.limiting[l]==O)||(g[l].id==O&&R.direction==g[l].direction);if(((g[l].value<R.value)==r&&g[l].value!=R.value)||(S!=undefined&&(g[l].value>S)==r&&g[l].value!=S)||(q[l]!=null&&q[l]!=undefined&&q[l].id!=R.id&&((g.manual==true&&q[l].value!=R.value&&((q[l].value<R.value)==r))||(g.manual==false&&q[l].realValue!=undefined&&q[l].realValue!=R.value&&((q[l].realValue<R.value)==r))))){if(M[l]&&M[l].id==O){delete M[l]}if(T){N[l]=R;N[l].update=true}if(e.unactivatedLimits[l]){M[l]=e.unactivatedLimits[l];M[l].update=true}else if(e.unactivatedLimits[n]){M[n]=e.unactivatedLimits[n];M[n].update=true}delete e.unactivatedLimits[l];delete e.unactivatedLimits[n]}else if((g[l].value>R.value)==r||(T&&g[l].value==R.value)){if(e.unactivatedLimits[l]&&e.unactivatedLimits[l].id==O){continue}if(!T&&M[l]&&!M[l].update){e.unactivatedLimits[l]=M[l];e.unactivatedValues[l]=S;N[l]=M[l];N[l].update=true}if(!T&&M[n]&&!M[n].update){e.unactivatedLimits[n]=M[n];e.unactivatedValues[n]=e.startLimitValue[n];N[n]=M[n];N[n].update=true;delete M[n]}if(!T&&e.startLimitValue[l]){e.unactivatedValues[l]=e.startLimitValue[l]}if(!T&&e.startLimitValue[n]){e.unactivatedValues[n]=e.startLimitValue[n]}if(T&&((M[l]&&M[l].update)||(M[n]&&M[n].update))){N[l]=R;N[l].update=true;continue}M[l]=R;M[l].update=!T}}for(var l in M){if(M[l].id!=""&&!M[l].update){continue}if(M[l].update){e.limiting[l]=M[l].id;var n=$.magic.coord.opposite(l);if(e.unactivatedValues[l]){e.startLimitValue[l]=e.unactivatedValues[l]}else{e.startLimitValue[l]=g[l].value}K=true;K=true;G[M[l].direction]=M[l].id;if(!E[l]&&g[l].id!=d){J=true;E[l]=g[l]}if(!E[n]&&g[n].id!=d&&g[l].id==g[n].id&&g[l].direction==g[n].direction){J=true;E[n]=g[n]}}I=true;F[l]=M[l]}for(var l in N){if(!N[l].update){continue}var n=$.magic.coord.opposite(l);delete e.limiting[l];delete e.startLimitValue[l];if(!E[l]){J=true;E[l]=N[l];E[l].add=false;L=true;H[N[l].direction]=N[l].id}if((g.manual==true||(g.manual==false&&q[l]&&q[l].realValue!=undefined&&M[l]==undefined&&M[n]==undefined))&&q[l]&&q[l].unAligned&&q[l].id!=N[l].id){I=true;F[l]=q[l].unAligned}if(g.manual==true&&q[n]&&q[n].unAligned&&q[n].id!=N[l].id){I=true;F[n]=q[n].unAligned}}for(var i in E){if(E[i].add==false){continue}if(!e.unAligned[i]){e.unAligned[i]=[]}e.unAligned[i].push({id:E[i].id,direction:E[i].direction,offset:E[i].offset});e.unAligned[i]=$.magic.tools.removeDuplicates(e.unAligned[i])}if(J){var U={manual:true};for(var k in E)U[E[k].direction]=E[k].id;c=c.unAlign(U)}if(I){if(!$.magic.ghosts[d]){c.createGhost(true);c=$("#"+d)}var V={manual:true,offset:$.magic.alignTargets[d]?$.magic.alignTargets[d].options.offset:[]};for(var l in F){var n=$.magic.coord.opposite(l);if(F[l].id!=d&&$.magic.coord.isDirection(l)){V[F[l].direction]=F[l].id;if(F[l].offset){V.offset[l]=F[l].offset}e.unAligned[l]=$.magic.tools.removeItems(e.unAligned[l],[{id:F[l].id,direction:F[l].direction,offset:F[l].offset}]);e.unAligned[n]=$.magic.tools.removeItems(e.unAligned[n],[{id:F[l].id,direction:F[l].direction}])}}c.align(V)}$.magic.limit[d]=e;delete e;$.magic.locked.limit=false;if(L){$(window).trigger("unLimit",d,[H]);}if(K){$(window).trigger("limit",d,[G]);}if(I||J){a.refreshAlignWatchers(d)}};$.fn.align=function(a){if($.magic.locked.align==true){return}return this._executeAlign(a)};$.fn._executeAlign=function(t){if(typeof t=="string"){t={top:t,right:t,bottom:t,left:t,offset:[]}}var u={top:null,right:null,bottom:null,left:null,topIsBottomOf:null,rightIsLeftOf:null,bottomIsTopOf:null,leftIsRightOf:null,offset:[],manual:true};t=$.extend({},u,t);return this.each(function(){var b=$(this);var c=b;var d=b.getNotNullId();var e=d;var f=b.coordinates();var g=$.magic.alignTargets[e];var h=$.magic.alignWatchers;if(g==undefined||g==null){g={options:t,alignFunction:function(){if($.magic.locked.refreshAlignWatchers){return}if($.magic.alignTargets[e]){var a=$("#"+e);a.align($.magic.alignTargets[e].options)}}};c.parent().resize(function(){g.alignFunction()});if($.magic.browser.fixedSupport){$.magic.bodyWrapper.resize(g.alignFunction)}}else{g.options.offset=t.offset;g.options.manual=g.options.manual?t.manual:!t.manual;t.manual=null;for(x in g.options){if(t[x]!=null){g.options[x]=t[x]}}t=g.options}$.magic.locked.align=true;var i=false;if($.magic.ghosts[d]!=null&&($.magic.ghosts[d]!=undefined)){d=$.magic.ghosts[d];b=$('#'+d)}else if(b.hasClass($.magic.staticClass)){b.removeClass($.magic.staticClass)}var j=b.parent();var k={};var l=0;var m=null;var n={top:"auto",right:"auto",bottom:"auto",left:'auto'};for(x in t){if(t[x]==null||!$.magic.coord.isDirection(x)||t[x]==e){continue}k[x]=$.magic.getElementFromNotNullId(t[x]);if(h[t[x]]==null){h[t[x]]=new Array(e)}else{h[t[x]].push(e);h[t[x]]=$.magic.tools.removeDuplicates(h[t[x]])}if(t[x]==""&&$.magic.coord.isVertical(x)){i=true}else{if(!k[x].hasClass("alignTarget")){k[x].addClass("alignTarget")}if(t[x]!=""&&!k[x].is(":visible")){continue}if(i==false&&(k[x].closest('.'+$.magic.staticClass).length>0)){i=true}}l++;var o=$.magic.coord.side(x);n[o]=k[x].coordinates($.magic.coord.target(x));var p=t.offset[o]?($.magic.coord.isMaxValue(o)?-t.offset[o]:t.offset[o]):0;n[o]+=p}if(n.left=='auto'&&n.right=='auto'){n.left=f.left;if(t.offset.left){n.left+=t.offset.left}}if(n.top=='auto'&&n.bottom=='auto'){n.top=f.top;if(t.offset.top){n.top+=t.offset.top}}if(l!=0){var q=j;if(i&&$.magic.browser.fixedSupport){q=$(window);n=$(window).coordinatesOf(n);if(!b.hasClass($.magic.staticClass)){b.addClass($.magic.staticClass)}if(b.hasClass("absolute")){j.removeClass("absolute")}}else{if(!b.hasClass("absolute")){b.addClass("absolute")}if(b.hasClass($.magic.staticClass)){b.removeClass($.magic.staticClass)}j.css({position:'relative'});n=j.coordinatesOf(n)}var r=q.coordinates();if(n.top!="auto"&&n.bottom!='auto'){n.height=r.height-n.bottom-n.top-f.delta.height}if(n.right!="auto"&&n.left!="auto"){n.width=r.width-n.right-n.left-f.delta.width}delete q;$.magic.applyPosition(b,d,n)}$.magic.locked.align=false;$.magic.alignWatchers=h;delete h;$.magic.alignTargets[e]=g;delete g;if(l!=0){var s=c.coordinates();if(!$.magic.tools.areHashEqual(s,f)){b.refreshAlignWatchers(e)}}})};$.fn.unAlign=function(a){while($.magic.locked.unAlign==true){}return this._executeUnAlign(a)};$.fn._executeUnAlign=function(h){$.magic.locked.unAlign=true;var i=null;if(typeof h=="string"){h={top:h,topIsSouthOf:h,right:h,rightIsLeftOf:h,bottom:h,bottomIsTopOf:h,left:h,leftIsRightOf:h,manual:true}}var j={top:null,right:null,bottom:null,left:null,topIsBottomOf:null,rightIsLeftOf:null,bottomIsTopOf:null,leftIsRightOf:null,offset:[],manual:true};h=$.extend({},j,h);this.each(function(){var a=$(this);i=a;var b=a.getNotNullId();var c=$.magic.alignTargets[b];var d=$.magic.alignWatchers;var e=0;var f=0;if(c){for(var x in c.options){if(c.options[x]!=null&&$.magic.coord.isDirection(x)){e++;if(h[x]==c.options[x]){$.magic.alignWatchers[h[x]]=$.magic.tools.removeItems($.magic.alignWatchers[h[x]],[b]);c.options[x]=null;var g=$.magic.coord.side(x);if(c.options.offset[g]){delete c.options.offset[g]}}else{f++}}}}c.options.manual=c.options.manual?h.manual:!h.manual;if(e==0){$.magic.locked.unAlign=false;return}if(f==0){if(!a.hasClass("poppedIn")){if($.magic.locked.createGhost!=true){a=a.createGhost(false)}if($.magic.browser.fixedSupport){a.parent().unbind('resize',c.alignFunction);$.magic.bodyWrapper.unbind('resize',c.alignFunction)}}else{a=a.setPosition("absolute")}i=a;c=null}$.magic.locked.unAlign=false;if(c){$.magic.alignTargets[b]=c}else{delete $.magic.alignTargets[b]}});return i};$.fn.oldToggle=$.fn.toggle;$.fn.toggle=function(b){return this.each(function(){var a=$(this);if(a.hasClass("hidden")){a.removeClass("hidden")}else{a.oldToggle(b)}})};$.fn.setPosition=function(g){if(g==null||typeof g=="string"){g={position:g,offset:[],before:true}}var h={position:"absolute",offset:[]};var g=$.extend(h,g);return this.each(function(){var a=$(this);var b=a.getNotNullId();if(g.position==null&&$.magic.ghosts[b]){if(!$.magic.locked.unAlign&&$.magic.alignTargets[b]){a.unAlign($.magic.alignTargets[b].options)}a.createGhost(false);if($.magic.limit[b]){$.magic.limit[b].limiting=[];$.magic.limit[b].unactivatedValues=[];$.magic.limit[b].unactivatedLimits=[];$.magic.limit[b].unAligned=[];$.magic.limit[b].startLimitValue=[]}}else if(g.position=="absolute"||(g.position=="fixed"&&!$.magic.ghosts[b])){var c=a.coordinates();a.createGhost({create:true,before:g.before});a=$("#"+b);if(a.hasClass("hadGhost")){a.removeClass("hadGhost")}var d="";var e={left:c.left,top:c.top};if(g.position=="absolute"){var f=a.parent();d=f.getNotNullId();c=f.coordinatesOf(c);e={left:c.left,top:c.top}}e.left=g.offset.left?e.left+g.offset.left:g.offset.right?e.left-g.offset.right:e.left;e.top=g.offset.top?e.top+g.offset.top:g.offset.bottom?e.top-g.offset.bottom:e.top;a.align({left:d,top:d,offset:e,manual:false})}})};$.fn.popIn=function(){var e=0;this.each(function(){var a=$(this);if(a.hasClass("poppedIn")){return}e++;var b=a.getNotNullId();var c=$.magic.ghosts[b];if(c){var d=$("#"+$.magic.ghosts[b]);d.detach();d.appendTo($.magic.ghostContainer);$('#'+b).addClass('poppedIn hadGhost')}else{a.setPosition({position:"absolute",before:false});$('#'+b).addClass('poppedIn')}});if(e>0){var f=$("#popInVeil");if(f.length==0){$.magic.ghostContainer.prepend('<div id="popInVeil" style="filter:alpha(opacity=80);-moz-opacity:0.80;opacity:0.8;background:black;" class="absolute"></div>');f=$("#popInVeil");f.align('');f.toggle();f.click(function(){$(".poppedIn").popOut()});$("#popInVeil").fadeIn("slow")}}};$.fn.popOut=function(){me=this;if($(".poppedIn").length<=this.filter('.poppedIn').length){var a=$("#popInVeil");a.fadeOut("slow",function(){a.unAlign('');a.remove();$.magic.popOutCallBack(me)})}else if(this.length>0){$.magic.popOutCallBack(me)}};$.fn.createGhost=function(a){return this._executeCreateGhost(a)};$.fn._executeCreateGhost=function(l){if(typeof l=="boolean"){l={create:l,before:true}}var m=null;this.each(function(){var a=$(this);m=a;var b=a.getNotNullId();$.magic.locked.createGhost=true;if(l&&l.create==true&&!a.hasClass("ghost")&&($.magic.ghosts[b]==undefined||$.magic.ghosts[b]==null)){var c=a.coordinates();var d={width:a.width(),height:a.height()};for(var e in{"margin":"","padding":""}){for(var f in{"Top":"","Right":"","Bottom":"","Left":""}){d[e+f]=a.css(e+f)}}var g=a.attr("style");g=g?'style="'+g+'" savedstyle="'+g+'"':'savedstyle=" "';var h=a[0].nodeName.toLowerCase();a.before('<'+h+' id="'+b+'" '+g+' class="'+a.attr("class")+'"></'+h+'>');delete h;var i='Ghost-'+b;a.attr('id',i);a.css(d);if(l.before){$.magic.ghostContainer.prepend(a)}else{$.magic.ghostContainer.append(a)}var j=$('#'+b);j.css(d);if(!j.hasClass("invisible")){j.addClass("invisible")}k=a;a=j;k.addClass("ghost");$.magic.ghosts[b]=i}else if((!l||l.create==false)&&($.magic.ghosts[b]!=null&&$.magic.ghosts[b]!=undefined)){if(a.hasClass('invisible')){a.removeClass('invisible')}var k=$("#"+$.magic.ghosts[b]);a.before(k);k.attr("id",b);k.attr("class",a.attr("class"));k.attr("style",a.attr("savedstyle"));a.remove();a=$('#'+b);delete k;delete $.magic.ghosts[b]}m=a});$.magic.locked.createGhost=false;return m};$.fn.createMessage=function(h){if(typeof h=="string"){h={content:h}}var i={position:null,width:'200px',messageClass:'margin bkgDarker edit',content:'this is a message',lifeTime:null};h=$.extend(i,h);return this.each(function(){var a=$(this);var b=a._getOriginalId();var c=$('#'+b);var d=c.attr("message");if(d==null||d==undefined){var d='message-'+b;var e=' absolute wAuto';if(h.width){e=' absolute'}$("body").append('<div id="'+d+'" style="margin:0 !important;padding:0 !important;overflow:visible;" ><div style="width:'+(h.width?h.width:'')+'" class="'+e+' '+h.messageClass+'">'+h.content+'</div></div>');var f=$("#"+d);f.css("width",f.children(":first").outerWidth());c.attr('message',d);var g=new Array();if(!h.position){g={leftIsRightOf:b,top:b}}else{for(x in h.position){if(h.position[x]=='this'){g[x]=b}else{g[x]=h.position[x]}}}f.createGhost({create:true,before:false});f=$("#"+d);f.align(g);if(h.lifeTime){$.magic.timers[b]=setTimeout(function(){a.deleteMessage()},h.lifeTime);$("#"+$.magic.ghosts[d]).hoverIntent({sensitivity:7,interval:100,timeout:h.lifeTime,over:function(){clearTimeout($.magic.timers[b]);delete $.magic.timers[b]},out:function(){$.magic.timers[b]=setTimeout(function(){a.deleteMessage()},h.lifeTime)}})}}})};$.fn.deleteMessage=function(){return this.each(function(){var a=$(this);var b=a._getOriginalId();var c=$('#'+b);var d=c.attr("message");if(d){c.removeAttr('message');var e=$("#"+d);e.unAlign($.magic.alignTargets[d].options);e=$("#"+d);clearTimeout($.magic.timers[b]);delete $.magic.timers[b];e.empty().remove()}})};$.fn.setSubMenu=function(m){if(typeof m=="string"){m={id:m}}var n={id:null,hover:"hover",out:null,closeFunction:function(a){a.addClass("hidden")},keepOpen:false,openFunction:function(a){a.removeClass("hidden")},action:$.magic.defaultAction};var m=$.extend(n,m);return this.each(function(){var g=$(this);var h=g.parent();var i=$("#"+m.id);var j=g.getNotNullId();var k=h.getNotNullId();if($.magic.menu[k]==null){$.magic.menu[k]=new Array()}$.magic.menu[k][j]={sub:i,options:{ulId:k,sub:i,hoverClass:m.hover,outClass:m.out,closeFunction:m.closeFunction,openFunction:m.openFunction,action:m.action,keepOpen:m.keepOpen}};$.magic.menu[k].action=m.action;i.attr("ul",k);i.attr("li",j);g.attr('menuItem',1);if(m.action=="over"){g.hoverIntent({sensitivity:7,interval:0,timeout:300,over:function(){var a=$(this);var b=a._getOriginalId();var c=a.parent();var d=c._getOriginalId();var e=$.magic.menu[d][b].sub;if(c.attr("actif")=="1"){c.pause();a.showSubMenu({li:a,liId:b,ul:c,ulId:d,options:$.magic.menu[d][b].options})}else{setTimeout(function(){c.pause();a.showSubMenu({li:a,liId:b,ul:c,ulId:d,options:$.magic.menu[d][b].options})},400)}},out:function(){var a=$(this);var b=a._getOriginalId();var c=a.parent();var d=c._getOriginalId();var e=$.magic.menu[d][b].sub;if(e.attr("actif")!="1"){if(a.attr("forced")=="1"){c.play()}else if(m.keepOpen==false){a.removeAttr("hover");a.removeClass(m.hover);if(m.out){a.addClass(m.out)}if(m.keepOpen==false){m.closeFunction(e)}}}}});if($.browser.msie){i.find('a').mouseenter(function(){$("#"+m.id).attr("actif","1")})}i.hoverIntent({sensitivity:7,interval:0,timeout:500,over:function(){var a=$(this).attr("ul");var b=$("#"+a);b.pause();$(this).attr("actif","1")},out:function(){var a=$(this).attr("ul");var b=$("#"+a);var c=$(this).attr("li");var d=$("#"+c);if(b.attr("actif")!="1"){if(d.attr("forced")=="1"){b.play()}else if(m.keepOpen==false){d.closeSubMenu($.magic.menu[a][c].options)}}}});h.hoverIntent({sensitivity:7,interval:100,timeout:300,over:function(){$(this).attr("actif","1")},out:function(){$(this).attr("actif","0")}})}else if(m.action=="click"){var l=g.find("a:first");l.live("click",function(){var a=$(this).closest("li");var b=a._getOriginalId();var c=a.parent();var d=c._getOriginalId();var e=$.magic.menu[d][b].sub;if($.magic.menu[d][b].modulo==undefined){$.magic.menu[d][b].modulo=3;if($(this).attr("href")==''){$.magic.menu[d][b].modulo=2}}var f=a.attr("nbClicks");if((f==undefined)||(i.attr("actif")==0)){f=0}f=(parseInt(f)+1)%$.magic.menu[d][b].modulo;a.attr("nbClicks",f);if(f==1){c.attr("actif","1");c.pause();a.showSubMenu({li:a,liId:b,ul:c,ulId:d,options:$.magic.menu[d][b].options});return false}if(f==0){if(a.attr("forced")=="1"){c.play()}else{if(m.keepOpen==true){a.attr("nbClicks",1)}else{c.attr("actif","0");a.removeAttr("hover");a.removeClass(m.hover);if(m.out){a.addClass(m.out)}m.closeFunction(i)}}return false}})}})};$.fn.openMenu=function(b){var c={forced:false};var b=$.extend(c,b);return this.each(function(){var a=$(this);if(a.attr("nodeName").toLowerCase()=="ul"){a.openNextMenu({forced:true})}else{a.attr('forced',"1");a.showSubMenu()}})};$.fn.openNextMenu=function(e){return this.each(function(){var a=$(this);if(a.attr("nodeName").toLowerCase()=="li"){a=a.parent()}var b=a.children('li[menuItem]');var c=b.filter('[hover]');if(c.length==0){var d=b.first()}else{var d=c.nextAll('[menuItem]').first();if(d.length==0){d=b.first()}}d.openMenu({forced:false})})};$.fn.openPrevMenu=function(){return this.each(function(){var a=$(this);if(a.attr("nodeName").toLowerCase()=="li"){a=a.parent()}var b=a.children('li[menuItem]');var c=b.filter('[hover]');if(c.length==0){var d=b.last()}else{var d=c.prevAll('[menuItem]').first();if(d.length==0){d=b.last()}}d.openMenu({forced:false})})};$.fn.play=function(c){return this.each(function(){var a=$(this);var b=a._getOriginalId();if($.magic.menu[b]==undefined){return}if($.magic.menu[b].options){$.magic.menu[b].options.flip=c?c:$.magic.menu[b].options.flip}else{$.magic.menu[b].options={flip:c?c:3000,playing:false}}if(!$.magic.menu[b].options.playing){a.openMenu({forced:true});$.magic.menu[b].options.playing=true}clearTimeout($.magic.menu[b].timer);$.magic.menu[b].timer=setInterval(function(){a.openNextMenu({forced:true})},$.magic.menu[b].options.flip)})};$.fn.pause=function(){return this.each(function(){var a=$(this);var b=a._getOriginalId();if($.magic.menu[b]&&$.magic.menu[b].timer){clearTimeout($.magic.menu[b].timer)}})};$.fn.stop=function(){$(this).closeMenu()};$.fn.closeMenu=function(){return this.each(function(){var a=null;var b=$(this);if(b.attr("nodeName").toLowerCase()=="ul"){var c=b._getOriginalId();a=b.find('li[hover]');if($.magic.menu[c]&&$.magic.menu[c].timer){clearTimeout($.magic.menu[c].timer)}$.magic.menu[c].options.playing=false}else{a=b}a.attr("forced",'0');a.closeSubMenu(null)})};$.fn.showSubMenu=function(a){if(!a){a=[];a.li=$(this);a.liId=a.li.getNotNullId();a.ul=a.li.parent();a.ulId=a.ul.getNotNullId();a.options=$.magic.menu[a.ulId][a.liId].options}if((a.ul.attr("actif")=="1")||(a.li.attr("forced")=="1")){var b=a.ul.children('[hover]');if(b.length>0){var c=b._getOriginalId();if(c!=a.liId){a.li.attr("forced",b.attr("forced"));b.attr("forced","0");b.removeAttr("hover");b.closeSubMenu($.magic.menu[a.ulId][c].options)}}a.li.addClass(a.options.hoverClass);if(a.options.outClass){a.li.removeClass(a.options.outClass)}a.li.attr("hover",'1');if(a.options.action=="click"){a.options.sub.attr("actif",'1');a.li.attr("nbClicks",'1')}a.options.openFunction(a.options.sub)}};$.fn.closeSubMenu=function(f){return this.each(function(){var a=$(this);if(a.attr("forced")!="1"){if(f==null){var b=a.parent();var c=b._getOriginalId();var d=a._getOriginalId();f=$.magic.menu[c][d].options}if(f!=null){if(f.action=="click"){a.attr("nbClicks",'0')}a.removeAttr("hover");var e=$.magic.menu[f.ulId][a.attr('id')].sub;a.removeClass(f.hoverClass);if(f.outClass){a.addClass(f.outClass)}f.closeFunction(e);e.attr("actif",'0')}}})}})(jQuery);$(document).ready(function(){$.magic.init()});